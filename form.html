
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="bootstrap-4.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="js/jquery-3.4.1.slim.min.js"></script>
    <script src="bootstrap-4.4.1/js/bootstrap.min.js"></script>
    <style>
      body {
        background-color: #121212;
        color: #e0e0e0;
      }

      .card {
        background-color: #1e1e1e;
        border: 1px solid #333;
      }

      .form-control {
        background-color: #2c2c2c;
        color: #e0e0e0;
        border: 1px solid #444;
      }

      .form-control:focus {
        background-color: #2c2c2c;
        color: #fff;
        border-color: #777;
        box-shadow: none;
      }

      .btn-primary {
        background-color: #007bff;
        border-color: #007bff;
      }

      .btn-primary:hover {
        background-color: #0056b3;
      }

      label {
        color: #ccc;
      }

      .alert-success {
        background-color: #1c3f1c;
        color: #b6fcb6;
        border-color: #2e662e;
      }

      .alert-danger {
        background-color: #4b1c1c;
        color: #fcb6b6;
        border-color: #662e2e;
      }

      input[readonly] {
        background-color: #2c2c2c !important;
        color: #e0e0e0 !important;
        border: 1px solid #444 !important;
      }
    </style>
    <title>Leaderboard Submission Form</title>
  </head>
  <body class="bg-dark">
    <div class="container mt-5">
      <div class="card shadow-sm">
        <div class="card-body">
          <h4 class="card-title mb-4">Form Data</h4>

          <form id="dataForm">
            <div class="form-group">
              <label class="text-primary" for="stageId">Select the Stage</label>
              <input type="text" class="form-control" id="stageId" name="stageId" required>
            </div>
            
            <div class="form-group">
              <label class="text-primary" for="uid">UID</label>
              <input type="text" class="form-control" id="uid" name="uid" required>
            </div>

            <div id="formFields" name="formFields"></div>

            <button type="submit" class="btn btn-primary">Submit</button>
          </form>

          <div id="resultMessage" class="mt-3"></div>
        </div>
      </div>
    </div>
    <script src="database.js"></script>
    <script>
      const idInputFields = ["ld","m2","m3","m4","m5","al","cf","ct"];
      const sourceMap = {
        ld: lbMonster,
        m2: lbMonster,
        m3: lbMonster,
        m4: lbMonster,
        m5: lbMonster,
        al: lbMonster,
        cf: lbCraft,
        ct: lbChronon
      };

      let alreadyFilled = false;

      document.getElementById("dataForm").addEventListener("submit", async function(e) {
        e.preventDefault();

        if(alreadyFilled) {
          document.getElementById("resultMessage").textContent = "Refresh the page for more input. (Intended)";
          return;
        }

        const _stg = document.getElementById("stageId").value;
        const _uid = document.getElementById("uid").value;

        if (_stg === "") {
          document.getElementById("resultMessage").textContent = "Please select a stage.";
          return;
        }

        const payload = {
          target: "data",
          data: {
            stg: _stg,
            uid: _uid,
            ld: document.getElementById("ldField").value,
            m2: document.getElementById("m2Field").value || 0,
            m3: document.getElementById("m3Field").value || 0,
            m4: document.getElementById("m4Field").value || 0,
            m5: document.getElementById("m5Field").value || 0,
            al: document.getElementById("alField").value,
            cf: document.getElementById("cfField").value || 0,
            ct: document.getElementById("ctField").value || 0
          }
        };

        const url = "https://script.google.com/macros/s/AKfycbxJHaX2DZMqPaDfLWQoJuUSBLOK-lgpv2Ngszkfx_MCsXPmQiiNQoaeJKJHDxlQGzuHKA/exec";

        fetch(url, {
          method: "POST",
          mode: "no-cors",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(payload),
        })
        .then(() => {
          document.getElementById("resultMessage").textContent = "Thank you, have a nice day!";
          alreadyFilled = true;
        })
        .catch(err => {
          document.getElementById("resultMessage").textContent = "Error: " + err;
        });
      });
      setFormMode("id");
    </script>
  </body>
</html>